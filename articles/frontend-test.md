---
title: "フロントエンドのテストについて考えてみた"
emoji: "📚"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ['frontend', 'test', 'jest', 'react', 'typescript']
published: false
---

# フロントエンドのテスト、やってますか？

こんにちは。zu（[@asazutaiga](https://twitter.com/asazutaiga)）です。

私は現在、自社のシステム刷新に当たって、Next.jsアプリケーションの環境構築を行っています。これにはテスト環境の構築も含まれています。

テストについてあまり多くの知見や実務経験を持っていないので、ネット上で調べものをしながらよりよい環境を整備しようと試みているところです。

以下では、テスト環境の整備における思考過程と、個人的・暫定的な結論を述べていきます。

必ずしも正しい・網羅的な見解ではないことは、ご承知おきください。
また、フロントエンドのテストについての皆様のお考え、本記事への指摘や感想をコメントやTwitterなどで教えてくれると嬉しいです。PRも歓迎です。

## 前提

以下では静的な型検査・Lintも含めた、コード的に品質を保証する行為のことを「テスト」と呼びます。逆に、手動での動作確認については取り扱いません。[^1]

# テストの対象と方法

## 問題１. 何をテストするのか

Jestなどの便利なテスティングライブラリやCI環境の豊富な現代では、「とりあえずテストをいれるべきだ」「ないよりはあった方がマシだ」という考え方も十分にありえます。
（ある程度まともなテスト項目を考え出せる人がやるのであれば、）テストを全くしないよりは、テストをした方が必ずよりよいはずです。

しかし、効果を説明できないテストコードの実装に時間をかけてしまうのは、リポジトリのステークホルダー全員にとって不幸な結果を招くかもしれません。

あらためて、テストの対象領域について考えてみます。

## 問題2. どうやってテストするのか

何をテストするのかがわかったら、今度はそれに対して適切なアプローチを取らなければなりません。

幸い、それぞれのテスト手法に対して、デファクトとなっている方法を利用することが可能です。

テスト向けのライブラリの特徴と導入方法について、簡単に見ていきたいと思います。

# 何をテストするのか

## Testing Trophy

何をテストするのかを考えるにあたって参考になる、以下の画像をご覧ください。有名なのでご存じの人も多そう。

![TestingTrophy](https://testingjavascript.com/static/trophyWithLabels@2x-4d0c19a94d88ac607cc5cbeaa8f8708d.png)

FYI: https://testingjavascript.com/

簡単に説明すると、JavaScriptのテストは以下の4層で実施される（べきである）という思想を図式化したものになります。[^2]

- End To End...selenium, cypressなどブラウザ上での動作のシミュレーションによるテスト
- Integration...結合テスト、サーバーをモックしてフロントの各コンポーネント・関数の連携をテストするイメージ
- Unit...単体テスト、コンポーネント・関数など機能単位でのテスト
- Static...Lintや型検査などの静的な検査

※Integrationのあたりが個人的にイメージしづらかったのですが、[TestingTrophy考案者であるKentの記事](https://kentcdodds.com/blog/static-vs-unit-vs-integration-vs-e2e-tests)で紹介されているテストコードを読めば、イメージがつかめるのではないかと思います。

静的な検査もテストのうちに含めることに注意してください。本稿でも「テスト」という言葉を使う際は、静的な検査を含めた、ソフトウェアの品質をソフトウェアで保証する行為のことを指します。

以下はTesting Trophyに対する私の感想です。

### 現実世界のWebアプリ開発で、すべての層でテストすることは難しい

すべての層でのテストを着実に行えば、確かにソフトウェアの品質は高くなります。
しかし、恐らくですが、これらのテストを着実にこなしていった場合、製品のソースコード本体を実装している時間よりも、テストコードを書いている時間の方が長くなってしまうのではないでしょうか？

アクティブユーザー数（バグ混入時の影響度合）や、サービスの性質にも依るかとは思いますが、製品本体よりもテストに時間をかけるのはビジネスとしていささか機会損失の感がぬぐえない気がします。
（もちろん、メンテナンスフェーズに入ったソースコードに対して、追加のテストを入れながらリファクタリングしていくことは素晴らしいと思います）

あくまで優先度をつけるとすれば、どの層をターゲットにするべきでしょうか？
私は、「なるべく下の層から固めていくこと」をおすすめしたいです。

### 下の層に行くほどリターン/コスト比が大きい

Testing Trophyで定義されている各層について、コストとリターンを考えてみましょう。ここでのコストとは、「環境の整備にかかる時間・手間」をさし、リターンは「そのテストがパスした場合にどのような尺度で品質が保証されたと言えるのか」をさします。




[^1]: 環境構築のフェーズで考える「テスト」に対しての問題意識があるので。

[^2]: Kentの用意したコースを実際に受けたわけではないので、解釈が間違ってたらごめんなさい。時間があるときにやりたい。